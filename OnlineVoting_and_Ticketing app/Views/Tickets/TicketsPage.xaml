<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="OnlineVoting_and_Ticketing_app.Views.Tickets.TicketsPage"
             Title="My Tickets"
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Padding="25" Spacing="5">
            <Label Text="My Collection" Style="{StaticResource Headline}" TextColor="{StaticResource White}"/>
            <Label x:Name="TicketCountLabel" Text="0 tickets secured" TextColor="{StaticResource TextSecondary}" FontSize="14"/>
        </VerticalStackLayout>

        <!-- Tickets List -->
        <RefreshView Grid.Row="1" x:Name="RefreshView" Refreshing="OnRefreshing" RefreshColor="{StaticResource Primary}">
            <CollectionView x:Name="TicketsCollectionView" SelectionMode="Single" SelectionChanged="OnTicketSelected" Margin="20,10">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource Border}" Padding="20">
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="15">

                                <!-- Event Info -->
                                <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="4">
                                    <Label Text="{Binding EventTitle}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource White}" LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding TicketTypeName}" FontSize="13" TextColor="{StaticResource Primary}" FontAttributes="Bold"/>
                                </VerticalStackLayout>

                                <!-- Price -->
                                <Label Grid.Row="0" Grid.Column="1" Text="{Binding Price, StringFormat='GHâ‚µ {0:N0}'}" 
                                       FontSize="18" FontAttributes="Bold" TextColor="{StaticResource White}" VerticalOptions="Start"/>

                                <!-- Details -->
                                <HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="20">
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="ðŸ“…" FontSize="14" VerticalOptions="Center"/>
                                        <Label Text="{Binding PurchasedAt, StringFormat='{0:MMM dd}'}" FontSize="13" TextColor="{StaticResource TextSecondary}"/>
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="ðŸŽ«" FontSize="14" VerticalOptions="Center"/>
                                        <Label Text="{Binding TicketId}" FontSize="13" TextColor="{StaticResource TextSecondary}" Opacity="0.7"/>
                                    </HorizontalStackLayout>
                                </HorizontalStackLayout>

                                <!-- Status & Action -->
                                <HorizontalStackLayout Grid.Row="2" Grid.ColumnSpan="2" Spacing="10" VerticalOptions="Center">
                                    <Border StrokeShape="RoundRectangle 8" Padding="12,6" HorizontalOptions="Start">
                                        <Border.Triggers>
                                            <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="0">
                                                <Setter Property="BackgroundColor" Value="#2010B981" />
                                                <Setter Property="Stroke" Value="#3010B981" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="1">
                                                <Setter Property="BackgroundColor" Value="#206B7280" />
                                                <Setter Property="Stroke" Value="#306B7280" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="2">
                                                <Setter Property="BackgroundColor" Value="#20EF4444" />
                                                <Setter Property="Stroke" Value="#30EF4444" />
                                            </DataTrigger>
                                        </Border.Triggers>
                                        <Label Text="Valid" TextColor="#10B981" FontSize="11" FontAttributes="Bold">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding Status}" Value="1">
                                                    <Setter Property="Text" Value="Used" />
                                                    <Setter Property="TextColor" Value="#9CA3AF" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding Status}" Value="2">
                                                    <Setter Property="Text" Value="Cancelled" />
                                                    <Setter Property="TextColor" Value="#F87171" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </Border>
                                    <Label Text="View Details â†’" TextColor="{StaticResource Secondary}" FontSize="12" VerticalOptions="Center" FontAttributes="Bold"/>
                                </HorizontalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="25" Padding="40" Margin="0,50,0,0">
                        <Border WidthRequest="100" HeightRequest="100" StrokeShape="RoundRectangle 50" BackgroundColor="{StaticResource Surface}" Stroke="{StaticResource GlassBorderBrush}">
                            <Label Text="ðŸŽ«" FontSize="40" HorizontalOptions="Center" VerticalOptions="Center" Opacity="0.5"/>
                        </Border>
                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="No Tickets Found" Style="{StaticResource Headline}" FontSize="20" HorizontalOptions="Center" TextColor="{StaticResource White}"/>
                            <Label Text="Your digital collection is empty." FontSize="14" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                        <Button Text="Discover Events" Clicked="OnBrowseEventsClicked" Style="{StaticResource Button}" WidthRequest="200" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <ActivityIndicator Grid.Row="1" x:Name="LoadingIndicator" IsRunning="False" IsVisible="False" Color="{StaticResource Primary}" VerticalOptions="Center" HorizontalOptions="Center" />
    </Grid>
</ContentPage>
