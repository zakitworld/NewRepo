<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ffimageloading="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Maui"
             x:Class="OnlineVoting_and_Ticketing_app.Views.Polls.PollsPage"
             Title="Polls &amp; Voting"
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*">
        <!-- Background Glow -->
        <Ellipse Grid.RowSpan="2" WidthRequest="300" HeightRequest="300" 
                 Fill="{StaticResource Secondary}" Opacity="0.05" 
                 VerticalOptions="Start" HorizontalOptions="Start" Margin="-100,-100,0,0"/>

        <!-- Header Section -->
        <VerticalStackLayout Grid.Row="0" Padding="25,25,25,15" Spacing="5">
            <Label Text="Polls" Style="{StaticResource Headline}" HorizontalOptions="Start"/>
            <Label Text="Your voice shaping the future" Style="{StaticResource SubHeadline}" HorizontalOptions="Start"/>
        </VerticalStackLayout>

        <!-- Main Content -->
        <RefreshView Grid.Row="1" x:Name="RefreshView" Refreshing="OnRefreshing" RefreshColor="{StaticResource Primary}">
            <CollectionView x:Name="PollsCollectionView" SelectionMode="Single" SelectionChanged="OnPollSelected" Margin="20,0">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="20" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource Border}" Padding="20">
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*">
                                <!-- Status and Total Votes -->
                                <Grid Grid.Row="0" ColumnDefinitions="Auto,*" Margin="0,0,0,15">
                                    <Border StrokeShape="RoundRectangle 8" Padding="10,4" StrokeThickness="0" HorizontalOptions="Start">
                                        <Border.Triggers>
                                            <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="1">
                                                <Setter Property="BackgroundColor" Value="#2010B981" />
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <Label Text="ACTIVE" TextColor="#10B981" FontSize="10" FontAttributes="Bold"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="2">
                                                <Setter Property="BackgroundColor" Value="#206B7280" />
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <Label Text="CLOSED" TextColor="#6B7280" FontSize="10" FontAttributes="Bold"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Border.Triggers>
                                    </Border>
                                    <Label Grid.Column="1" Text="{Binding TotalVotes, StringFormat='{0} Participants'}" 
                                           TextColor="{StaticResource TextSecondary}" FontSize="12" 
                                           HorizontalOptions="End" VerticalOptions="Center"/>
                                </Grid>

                                <!-- Title and Description -->
                                <VerticalStackLayout Grid.Row="1" Spacing="8" Margin="0,0,0,20">
                                    <Label Text="{Binding Title}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource White}"/>
                                    <Label Text="{Binding Description}" FontSize="14" LineHeight="1.4" 
                                           TextColor="{StaticResource TextSecondary}" MaxLines="2" LineBreakMode="TailTruncation"/>
                                </VerticalStackLayout>

                                <!-- Footer Info -->
                                <Grid Grid.Row="2" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                    <Border WidthRequest="32" HeightRequest="32" StrokeShape="RoundRectangle 16" 
                                            Background="{StaticResource Surface}" StrokeThickness="0">
                                        <Label Text="ðŸ‘¤" HorizontalOptions="Center" VerticalOptions="Center" FontSize="14"/>
                                    </Border>
                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding CreatorName}" TextColor="{StaticResource White}" FontSize="13" FontAttributes="Bold"/>
                                        <Label Text="{Binding EndDate, StringFormat='Ends {0:MMM dd}'}" 
                                               TextColor="{StaticResource TextSecondary}" FontSize="11"/>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" Text="Vote Now â†’" TextColor="{StaticResource Primary}" 
                                           FontSize="13" FontAttributes="Bold" HorizontalOptions="End" VerticalOptions="Center"/>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="20" Padding="40">
                        <Label Text="ðŸ“Š" FontSize="60" HorizontalOptions="Center"/>
                        <Label Text="Silence is golden, but not here." Style="{StaticResource SubHeadline}"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <!-- FAB -->
        <Border Grid.Row="1" StrokeShape="RoundRectangle 28" StrokeThickness="0" 
                BackgroundColor="{StaticResource Primary}" WidthRequest="56" HeightRequest="56" 
                HorizontalOptions="End" VerticalOptions="End" Margin="20">
            <Label Text="+" FontSize="30" TextColor="White" HorizontalOptions="Center" VerticalOptions="Center"/>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnCreatePollTapped" />
            </Border.GestureRecognizers>
        </Border>

        <ActivityIndicator Grid.Row="1" x:Name="LoadingIndicator" IsRunning="False" 
                          IsVisible="False" Style="{StaticResource ActivityIndicator}" 
                          VerticalOptions="Center" HorizontalOptions="Center"/>
    </Grid>
</ContentPage>
